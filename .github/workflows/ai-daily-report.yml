name: Daily AI Research Report
on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ9ç‚¹æ‰§è¡Œ (UTCæ—¶é—´å‡Œæ™¨1ç‚¹)
    - cron: '0 1 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      force_run:
        description: 'å¼ºåˆ¶æ‰§è¡Œä»»åŠ¡'
        required: false
        default: 'false'

jobs:
  send-daily-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: å‘é€æ¯æ—¥AIç ”ç©¶æŠ¥å‘Š
      run: |
        echo "å¼€å§‹æ‰§è¡Œæ¯æ—¥AIç ”ç©¶æŠ¥å‘Šä»»åŠ¡..."
        
        # è°ƒç”¨ç®¡ç†åå°APIæ‰§è¡Œæ¯æ—¥ä»»åŠ¡
        response=$(curl -s -w "%{http_code}" \
          -X POST \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}" \
          -d '{"action": "daily_task"}' \
          "${{ secrets.SITE_URL }}/api/daily-task" \
          -o response.json)
        
        http_code="${response: -3}"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… æ¯æ—¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ"
          cat response.json
        else
          echo "âŒ æ¯æ—¥ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼ŒHTTPçŠ¶æ€ç : $http_code"
          cat response.json
          exit 1
        fi
    
    - name: é€šçŸ¥æ‰§è¡Œç»“æœ
      if: always()
      run: |
        if [ $? -eq 0 ]; then
          echo "ğŸ‰ AIç ”ç©¶æ—¥æŠ¥å‘é€æˆåŠŸï¼"
        else
          echo "âš ï¸ AIç ”ç©¶æ—¥æŠ¥å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        fi
