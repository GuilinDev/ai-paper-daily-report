name: Daily AI Research Report

on:
  schedule:
    # æ¯å¤©ç¾å›½ä¸œéƒ¨æ—¶é—´æ™šä¸Š11:15æ‰§è¡Œ (EST 23:15 = UTC 04:15)
    # æ³¨æ„ï¼šGitHub Actionsä½¿ç”¨UTCæ—¶é—´ï¼Œé¿å¼€æ•´ç‚¹é«˜å³°
    - cron: '30 11 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      force_run:
        description: 'å¼ºåˆ¶æ‰§è¡Œä»»åŠ¡'
        required: false
        default: 'false'

jobs:
  send-daily-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: å‘é€æ¯æ—¥AIç ”ç©¶æŠ¥å‘Š
      run: |
        echo "å¼€å§‹æ‰§è¡Œæ¯æ—¥AIç ”ç©¶æŠ¥å‘Šä»»åŠ¡..."
        
        # è°ƒç”¨Netlifyéƒ¨ç½²çš„ç½‘ç«™API
        # ä½¿ç”¨SITE_URLæ„å»ºå®Œæ•´çš„Function URL
        FUNCTION_URL="${{ secrets.SITE_URL }}/.netlify/functions/daily-task"
        echo "è°ƒç”¨Function: $FUNCTION_URL"
        
        response=$(curl -s -w "%{http_code}" \
          -X POST \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}" \
          -d '{}' \
          "$FUNCTION_URL" \
          -o response.json)
        
        http_code="${response: -3}"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… æ¯æ—¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ"
          cat response.json
        else
          echo "âŒ æ¯æ—¥ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼ŒHTTPçŠ¶æ€ç : $http_code"
          cat response.json
          exit 1
        fi
    
    - name: é€šçŸ¥æ‰§è¡Œç»“æœ
      if: always()
      run: |
        if [ $? -eq 0 ]; then
          echo "ğŸ‰ AIç ”ç©¶æ—¥æŠ¥å‘é€æˆåŠŸï¼"
        else
          echo "âš ï¸ AIç ”ç©¶æ—¥æŠ¥å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        fi
